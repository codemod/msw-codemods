var E=Object.defineProperty;var Q=Object.getOwnPropertyDescriptor;var V=Object.getOwnPropertyNames;var v=Object.prototype.hasOwnProperty;var G=(n,t)=>{for(var o in t)E(n,o,{get:t[o],enumerable:!0})},J=(n,t,o,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of V(t))!v.call(n,r)&&r!==o&&E(n,r,{get:()=>t[r],enumerable:!(s=Q(t,r))||s.enumerable});return n};var X=n=>J(E({},"__esModule",{value:!0}),n);var te={};G(te,{handleSourceFile:()=>ee});module.exports=X(te);var e=require("ts-morph");function R(n,t,o){let s=n.getImportDeclaration(t)??n.addImportDeclaration({moduleSpecifier:t});return s.getNamedImports().find(l=>l.getName()===o)??s.addNamedImport({name:o})}function D(n,t,o){let s=n.getImportDeclaration(t);if(!s)return null;let r=s.getNamedImports().find(l=>l.getName()===o);return r?r.getAliasNode()?.getText()||r.getName():null}function Y(n,t){let o=D(n,"msw","http"),s=D(n,"msw","graphql"),r=t.getChildrenOfKind(e.SyntaxKind.PropertyAccessExpression).at(0)?.getChildrenOfKind(e.SyntaxKind.Identifier)??[],l=r.at(0);if(!l)return!1;let u=(r.at(1)??l).getText(),A=l.getText()===o&&["all","get","post","put","patch","delete","head","options"].includes(u),c=l.getText()===s&&["query","mutation"].includes(u);return A||c}function O(n){let t=n.getArguments().at(1)??null;if(t===null)return null;let o=t.getChildrenOfKind(e.SyntaxKind.Parameter),s=t.asKind(e.SyntaxKind.ArrowFunction)??t.asKind(e.SyntaxKind.FunctionExpression)??null;if(s===null)return null;let r=t.getLastChildIfKind(e.SyntaxKind.Block)??t.getLastChild()??null;return r===null?null:[r,o,s]}var Z={"application/json":"json","application/xml":"xml","text/plain":"text"};function _(n){return n.getImportDeclarations().find(t=>t.getModuleSpecifier().getLiteralText().startsWith("msw"))!==void 0}function B(n,t){let o=!1,s=O(t);if(s===null)return;let[r,l,m]=s,[,u,A]=l;if(u&&((r.asKind(e.SyntaxKind.Block)??r.getParent())?.getDescendantsOfKind(e.SyntaxKind.CallExpression).filter(c=>c.getDescendantsOfKind(e.SyntaxKind.Identifier).at(0)?.getText()===u.getText()).forEach(c=>{let[,j]=c.getFirstChild()?.getChildrenOfKind(e.SyntaxKind.Identifier).map(i=>i.getText())??[];j==="once"&&t.addArgument("{ once: true }");let F=c.getDescendantsOfKind(e.SyntaxKind.CallExpression).filter(i=>i.getDescendantsOfKind(e.SyntaxKind.Identifier).at(0)?.getText()===A?.getText()),y=null,h=null,K=null,g=null,w=null,P={},x=null,C=null,N=null;for(let i of F){if(!i)throw new Error;if(i.wasForgotten()){o=!0;break}let k=i.getTypeArguments(),W=i.getArguments(),L=i.getExpression().getLastChildByKind(e.SyntaxKind.Identifier);if(!L)continue;let d=L.getText(),I=W.map(a=>a.asKind(e.SyntaxKind.StringLiteral)?.getLiteralText()??a.getText()),f=I.join(", ");if(["json","xml","text"].includes(d))y=d,h=f,K=k.map(a=>a.compilerNode);else if(d==="status")w=f;else if(d==="cookie"){let[a,p]=I;if(!a||!p)continue;g===null&&(g=""),g+=`${a}=${encodeURIComponent(p)};`}else if(d==="set"){let[a,p]=I;if(!a||!p)continue;a.toLowerCase()==="content-type"?y=y??Z[p.toLowerCase()]??null:P[a]=p}else if(d==="delay"){R(n,"msw","delay");let a=i.getParent()?.getChildIndex();if(!a)continue;if(i.getParent()?.asKindOrThrow(e.SyntaxKind.CallExpression).removeArgument(i),r.getKind()!==e.SyntaxKind.Block){let p=(0,e.createWrappedNode)(e.ts.factory.createBlock([e.ts.factory.createReturnStatement(r.compilerNode)]),{sourceFile:n.compilerNode}).asKindOrThrow(e.SyntaxKind.Block),q=e.ts.createPrinter({newLine:e.ts.NewLineKind.LineFeed}).printNode(e.ts.EmitHint.Unspecified,p.compilerNode,n.compilerNode);r.replaceWithText(q);let b=O(t);if(b===null)throw new Error;let[z,U,$]=b;r=z,l=U,m=$,a=0}r.asKindOrThrow(e.SyntaxKind.Block).insertStatements(a,`await delay(${Number(f)});`),m.isAsync()||m.setIsAsync(!0)}else d==="data"?x=f:d==="errors"?C=f:d==="extensions"?N=f:d==="body"&&(h=h??f)}if(o)return;let T=Object.entries(P).map(([i,k])=>e.ts.factory.createPropertyAssignment(e.ts.factory.createStringLiteral(i),e.ts.factory.createStringLiteral(k)));g&&T.push(e.ts.factory.createPropertyAssignment(e.ts.factory.createStringLiteral("Set-Cookie"),e.ts.factory.createStringLiteral(g)));let S=[...w?[e.ts.factory.createPropertyAssignment(e.ts.factory.createIdentifier("status"),e.ts.factory.createNumericLiteral(w))]:[],...T.length?[e.ts.factory.createPropertyAssignment(e.ts.factory.createIdentifier("headers"),e.ts.factory.createObjectLiteralExpression(T,!1))]:[]],M=(0,e.createWrappedNode)(e.ts.factory.createCallExpression(e.ts.factory.createPropertyAccessExpression(e.ts.factory.createIdentifier("HttpResponse"),e.ts.factory.createIdentifier(y??"json")),K??void 0,S.length?[e.ts.factory.createObjectLiteralExpression(S,!1)]:void 0),{sourceFile:n.compilerNode}).asKindOrThrow(e.SyntaxKind.CallExpression),H=e.ts.createPrinter({newLine:e.ts.NewLineKind.LineFeed}).printNode(e.ts.EmitHint.Unspecified,M.compilerNode,n.compilerNode);if(c.replaceWithText(H),c.insertArgument(0,h??"null"),x||C||N){let i=(c.getArguments().at(1)??c.insertArgument(1,"{}")).asKindOrThrow(e.SyntaxKind.ObjectLiteralExpression);x&&i.addPropertyAssignment({name:"data",initializer:x}),C&&i.addPropertyAssignment({name:"errors",initializer:C}),N&&i.addPropertyAssignment({name:"extensions",initializer:N})}c.formatText()}),o))return B(n,t)}function ee(n){if(_(n))return n.getDescendantsOfKind(e.SyntaxKind.CallExpression).filter(t=>Y(n,t)).forEach(t=>B(n,t)),R(n,"msw","HttpResponse"),n.getFullText()}0&&(module.exports={handleSourceFile});
