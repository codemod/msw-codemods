var g=Object.defineProperty;var y=Object.getOwnPropertyDescriptor;var K=Object.getOwnPropertyNames;var T=Object.prototype.hasOwnProperty;var C=(t,e)=>{for(var s in e)g(t,s,{get:e[s],enumerable:!0})},D=(t,e,s,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of K(e))!T.call(t,a)&&a!==s&&g(t,a,{get:()=>e[a],enumerable:!(n=y(e,a))||n.enumerable});return t};var O=t=>D(g({},"__esModule",{value:!0}),t);var w={};C(w,{handleSourceFile:()=>b});module.exports=O(w);var r=require("ts-morph");function h(t,e,s){let n=t.getImportDeclaration(e);if(!n)return null;let a=n.getNamedImports().find(i=>i.getName()===s);return a?a.getAliasNode()?.getText()||a.getName():null}function x(t,e){let s=[...t.getDescendantsOfKind(r.SyntaxKind.PropertyAccessExpression),...t.getDescendantsOfKind(r.SyntaxKind.BindingElement)].flatMap(n=>{let a=n.getDescendantsOfKind(r.SyntaxKind.Identifier);return e.filter(i=>a.some(c=>c.getText()===i))});return new Set(s)}function E(t,e){let s=t.getChildrenOfKind(r.SyntaxKind.Identifier),[n,a]=s;!n||!a||s.length===2&&a.findReferencesAsNodes().forEach(i=>i.replaceWithText(e??n.getText()))}function p(t,e,s,n){let a=!1;return t.getDescendantsOfKind(r.SyntaxKind.PropertyAccessExpression).forEach(i=>{if(e.includes(i.getName())&&i.getChildrenOfKind(r.SyntaxKind.Identifier)[0]?.getText()===s){let c=i.getChildrenOfKind(r.SyntaxKind.Identifier).at(-1)?.getText();if(!c)throw new Error("Could not find accessed identifier");a=!0,i.replaceWithText(n??c)}}),t.getDescendantsOfKind(r.SyntaxKind.ObjectBindingPattern).forEach(i=>{let c=[];i.getDescendantsOfKind(r.SyntaxKind.BindingElement).forEach(o=>{o.getDescendantsOfKind(r.SyntaxKind.Identifier).find(l=>e.includes(l.getText()))&&(E(o,n),c.push(o.getText()))}),c.length&&(a=!0,i?.replaceWithText(i.getText().replace(new RegExp(`(,\\s*)?(${c.join("|")})+(\\s*,)?`,"g"),(o,d,l,m)=>o&&![d,m].includes(o)?"":o)),i.getDescendantsOfKind(r.SyntaxKind.Identifier).length?i.formatText():i.getAncestors().find(o=>o.getKind()===r.SyntaxKind.VariableDeclaration)?.asKindOrThrow(r.SyntaxKind.VariableDeclaration).remove())}),a}function A(t,e){let s=h(t,"msw","http"),n=h(t,"msw","graphql"),a=e.getChildrenOfKind(r.SyntaxKind.PropertyAccessExpression).at(0)?.getChildrenOfKind(r.SyntaxKind.Identifier)??[],i=a.at(0);if(!i)return!1;let o=(a.at(1)??i).getText(),d=i.getText()===s&&["all","get","post","put","patch","delete","head","options"].includes(o),l=i.getText()===n&&["query","mutation"].includes(o);return d||l}function F(t){let e=t.getArguments().at(1)??null;if(e===null)return null;let s=e.getChildrenOfKind(r.SyntaxKind.Parameter),n=e.asKind(r.SyntaxKind.ArrowFunction)??e.asKind(r.SyntaxKind.FunctionExpression)??null;return n===null?null:[e.getChildrenOfKind(r.SyntaxKind.Block).at(0)??n,s,n]}function I(t){return t.getImportDeclarations().find(e=>e.getModuleSpecifier().getLiteralText().startsWith("msw"))!==void 0}function b(t){if(I(t))return t.getDescendantsOfKind(r.SyntaxKind.CallExpression).filter(e=>A(t,e)).forEach(e=>{let s=F(e);if(s===null)return;let[n,a,i]=s,[c]=a,o=x(n,["cookies","params"]);if(o.size&&p(n,Array.from(o),c?.getText()),x(n,["searchParams","url"]).size){p(n,["url"],c?.getText());let f=n.insertVariableStatement(0,{declarations:[{name:"url",initializer:"new URL(request.url)"}]});f.setDeclarationKind(r.VariableDeclarationKind.Const),f.formatText(),n.getDescendantsOfKind(r.SyntaxKind.Identifier).forEach(u=>{u.getText()==="searchParams"&&u.getParentIfKind(r.SyntaxKind.PropertyAccessExpression)?.getFirstChild()?.getText()==="searchParams"&&u.replaceWithText("url.searchParams")})}let l=n.getDescendantsOfKind(r.SyntaxKind.VariableDeclaration).find(f=>f.getFirstChildIfKind(r.SyntaxKind.Identifier)?.getText()==="body")??!1;p(n,["body"],c?.getText(),l?"reqBody":void 0)&&(n.insertVariableStatement(0,{declarations:[{name:l?"reqBody":"body",initializer:"await request.json()"}],declarationKind:r.VariableDeclarationKind.Const}),i.isAsync()||i.setIsAsync(!0))}),t.getFullText()}0&&(module.exports={handleSourceFile});
